{% extends "base.html" %}

{% block title %}Nova Ocorr√™ncia{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h1>Nova Ocorr√™ncia</h1>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Voltar</a>
        </div>
    </div>
    <div class="card-body">

    <form method="POST" enctype="multipart/form-data">
            <!-- DADOS B√ÅSICOS DA OCORR√äNCIA -->
            <div class="section">
                <h2>1. Dados B√°sicos da Ocorr√™ncia</h2>
                
                <div class="form-group">
                    <label for="tipo">Tipo de Ocorr√™ncia <span class="required">*</span></label>
                    <select name="tipo" id="tipo" class="form-control" required>
                        <option value="">Selecione...</option>
                        <option value="Busca Terrestre">Busca Terrestre</option>
                        <option value="Busca Mar√≠tima">Busca Mar√≠tima</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="data_fato">Data do Fato <span class="required">*</span></label>
                        <input type="date" name="data_fato" id="data_fato" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="data_acionamento">Data de Acionamento</label>
                        <input type="date" name="data_acionamento" id="data_acionamento" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label for="link">Link com Tracks do Google Earth</label>
                    <input type="url" name="link" id="link" class="form-control" placeholder="https://...">
                </div>
            </div>

            <!-- DADOS DO LOCAL -->
            <div class="section">
                <h2>2. Dados do Local</h2>
                
                <div class="form-group">
                    <label for="endereco">Endere√ßo <span class="required">*</span></label>
                    <input type="text" name="endereco" id="endereco" class="form-control" required placeholder="Rua, n√∫mero, bairro">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cidade">Cidade <span class="required">*</span></label>
                        <input type="text" name="cidade" id="cidade" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="complemento">Complemento</label>
                        <input type="text" name="complemento" id="complemento" class="form-control" placeholder="Ponto de refer√™ncia, detalhes">
                    </div>
                </div>

                <div class="form-group">
                    <label for="coordenada">Coordenadas</label>
                    <input type="text" name="coordenada" id="coordenada" class="form-control" placeholder="Latitude, Longitude">
                </div>
            </div>

            <!-- DADOS DA V√çTIMA -->
            <div class="section">
                <h2>3. Dados da V√≠tima</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="nome_vitima">Nome da V√≠tima <span class="required">*</span></label>
                        <input type="text" name="nome_vitima" id="nome_vitima" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="cpf">CPF</label>
                        <input type="text" name="cpf" id="cpf" class="form-control" placeholder="000.000.000-00">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="sexo">Sexo <span class="required">*</span></label>
                        <select name="sexo" id="sexo" class="form-control" required>
                            <option value="">Selecione...</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Feminino">Feminino</option>
                            <option value="N√£o informado">N√£o informado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="idade">Idade</label>
                        <input type="text" name="idade" id="idade" class="form-control" placeholder="Ex: 25 anos">
                    </div>
                </div>

                <div class="form-group">
                    <label for="naturalidade">Naturalidade</label>
                    <input type="text" name="naturalidade" id="naturalidade" class="form-control">
                </div>

                <div class="form-group">
                    <label for="filiacao">Filia√ß√£o</label>
                    <input type="text" name="filiacao" id="filiacao" class="form-control" placeholder="Nome dos pais">
                </div>

                <div class="form-group">
                    <label for="contatos">Contatos</label>
                    <input type="text" name="contatos" id="contatos" class="form-control" placeholder="Telefone, email">
                </div>

                <div class="form-group">
                    <label for="enderecos">Endere√ßos</label>
                    <input type="text" name="enderecos" id="enderecos" class="form-control" placeholder="Endere√ßo residencial">
                </div>

                <div class="form-group">
                    <label for="vestimentas">Vestimentas</label>
                    <textarea name="vestimentas" id="vestimentas" class="form-control" placeholder="Descri√ß√£o das roupas que a v√≠tima estava usando"></textarea>
                </div>

                <div class="form-group">
                    <label for="caracteristicas_vitima">Caracter√≠sticas da V√≠tima</label>
                    <textarea name="caracteristicas_vitima" id="caracteristicas_vitima" class="form-control" placeholder="Altura, peso, cor dos olhos, cabelo, etc."></textarea>
                </div>

                <div class="form-group">
                    <label for="condicoes_neurologicas">Condi√ß√µes Neurol√≥gicas</label>
                    <textarea name="condicoes_neurologicas" id="condicoes_neurologicas" class="form-control" placeholder="Alzheimer, dem√™ncia, etc."></textarea>
                </div>

                <div class="form-group">
                    <label for="inf_medicas">Informa√ß√µes M√©dicas</label>
                    <textarea name="inf_medicas" id="inf_medicas" class="form-control" placeholder="Medicamentos, doen√ßas, etc."></textarea>
                </div>

                <div class="form-group">
                    <label for="experiencia_e_resistencia">Experi√™ncia e Resist√™ncia</label>
                    <textarea name="experiencia_e_resistencia" id="experiencia_e_resistencia" class="form-control" placeholder="Experi√™ncia com √°gua, nata√ß√£o, etc."></textarea>
                </div>
            </div>

            <!-- CARACTER√çSTICAS DA √ÅREA DE BUSCA -->
            <div class="section">
                <h2>4. Caracter√≠sticas da √Årea de Busca</h2>
                
                <div class="form-group">
                    <label for="tipo_terreno_agua">Tipo de Terreno/√Ågua</label>
                    <select name="tipo_terreno_agua" id="tipo_terreno_agua" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="Terrestre">Terrestre</option>
                        <option value="Mar">Mar</option>
                        <option value="Rio">Rio</option>
                        <option value="Lago">Lago</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="condicoes_do_tipo_terreno">Condi√ß√µes do Terreno</label>
                    <textarea name="condicoes_do_tipo_terreno" id="condicoes_do_tipo_terreno" class="form-control" placeholder="Profundidade, correnteza, vegeta√ß√£o, etc."></textarea>
                </div>

                <div class="form-group">
                    <label for="condicoes_climaticas">Condi√ß√µes Clim√°ticas</label>
                    <textarea name="condicoes_climaticas" id="condicoes_climaticas" class="form-control" placeholder="Temperatura, vento, chuva, visibilidade, etc."></textarea>
                </div>
            </div>

            <!-- IMAGENS -->
            <div class="section">
                <h2>5. Imagens</h2>
                <p class="text-muted small">Marque as imagens que ser√£o utilizadas no relat√≥rio e fa√ßa o upload de cada uma.</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <div class="d-flex align-items-center gap-2 mb-2">
                            <input type="checkbox" name="usa_img_condic_metereologica" id="usa_img_condic_metereologica" checked>
                            <label for="usa_img_condic_metereologica" style="margin: 0; font-weight: 600;">Condi√ß√µes Meteorol√≥gicas</label>
                        </div>
                        <label for="img_condic_metereologica" class="file-upload-label">
                            <span id="label_img_condic_metereologica">üì∑ Clique para selecionar a imagem</span>
                        </label>
                        <input type="file" name="img_condic_metereologica" id="img_condic_metereologica" accept="image/*" class="file-input-field">
                    </div>
                    <div class="form-group">
                        <div class="d-flex align-items-center gap-2 mb-2">
                            <input type="checkbox" name="usa_img_local" id="usa_img_local" checked>
                            <label for="usa_img_local" style="margin: 0; font-weight: 600;">Imagem do Local</label>
                        </div>
                        <label for="img_local" class="file-upload-label">
                            <span id="label_img_local">üì∑ Clique para selecionar a imagem</span>
                        </label>
                        <input type="file" name="img_local" id="img_local" accept="image/*" class="file-input-field">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <div class="d-flex align-items-center gap-2 mb-2">
                            <input type="checkbox" name="usa_img_upv" id="usa_img_upv" checked>
                            <label for="usa_img_upv" style="margin: 0; font-weight: 600;">Imagem do UPV</label>
                        </div>
                        <label for="img_upv" class="file-upload-label">
                            <span id="label_img_upv">üì∑ Clique para selecionar a imagem</span>
                        </label>
                        <input type="file" name="img_upv" id="img_upv" accept="image/*" class="file-input-field">
                    </div>
                    <div class="form-group">
                        <div class="d-flex align-items-center gap-2 mb-2">
                            <input type="checkbox" name="usa_img_satelite_upv" id="usa_img_satelite_upv" checked>
                            <label for="usa_img_satelite_upv" style="margin: 0; font-weight: 600;">Imagem de Sat√©lite UPV</label>
                        </div>
                        <label for="img_satelite_upv" class="file-upload-label">
                            <span id="label_img_satelite_upv">üì∑ Clique para selecionar a imagem</span>
                        </label>
                        <input type="file" name="img_satelite_upv" id="img_satelite_upv" accept="image/*" class="file-input-field">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <div class="d-flex align-items-center gap-2 mb-2">
                            <input type="checkbox" name="usa_img_raio_busca" id="usa_img_raio_busca" checked>
                            <label for="usa_img_raio_busca" style="margin: 0; font-weight: 600;">Raio de Busca</label>
                        </div>
                        <label for="img_raio_busca" class="file-upload-label">
                            <span id="label_img_raio_busca">üì∑ Clique para selecionar a imagem</span>
                        </label>
                        <input type="file" name="img_raio_busca" id="img_raio_busca" accept="image/*" class="file-input-field">
                    </div>
                    <div class="form-group">
                        <div class="d-flex align-items-center gap-2 mb-2">
                            <input type="checkbox" name="usa_img_tab_mare" id="usa_img_tab_mare" checked>
                            <label for="usa_img_tab_mare" style="margin: 0; font-weight: 600;">T√°bua de Mar√©</label>
                        </div>
                        <label for="img_tab_mare" class="file-upload-label">
                            <span id="label_img_tab_mare">üì∑ Clique para selecionar a imagem</span>
                        </label>
                        <input type="file" name="img_tab_mare" id="img_tab_mare" accept="image/*" class="file-input-field">
                    </div>
                </div>

                <div class="form-group">
                    <div class="d-flex align-items-center gap-2 mb-2">
                        <input type="checkbox" name="usa_img_prev_temp_onda" id="usa_img_prev_temp_onda" checked>
                        <label for="usa_img_prev_temp_onda" style="margin: 0; font-weight: 600;">Previs√£o de Temperatura e Ondas</label>
                    </div>
                    <label for="img_prev_temp_onda" class="file-upload-label">
                        <span id="label_img_prev_temp_onda">üì∑ Clique para selecionar a imagem</span>
                    </label>
                    <input type="file" name="img_prev_temp_onda" id="img_prev_temp_onda" accept="image/*" class="file-input-field">
                </div>
            </div>

            <!-- IMAGENS CUSTOMIZADAS -->
            <div class="section">
                <h2>6. Imagens Adicionais (Customizadas)</h2>
                <p class="text-muted small">Adicione imagens com descri√ß√µes personalizadas que n√£o est√£o nas op√ß√µes acima.</p>
                
                <div id="custom-images-container">
                    <!-- Imagens customizadas ser√£o adicionadas aqui via JavaScript -->
                </div>
                
                <button type="button" id="add-custom-image-btn" class="btn btn-outline-primary btn-sm mt-2">
                    ‚ûï Adicionar Imagem Customizada
                </button>
            </div>

            <!-- HIST√ìRICO DA OCORR√äNCIA -->
            <div class="section">
                <h2>7. Hist√≥rico da Ocorr√™ncia</h2>
                
                <div class="form-group">
                    <label for="historico_ocorrencia">Hist√≥rico Detalhado <span class="required">*</span></label>
                    <textarea name="historico_ocorrencia" id="historico_ocorrencia" class="form-control" rows="6" required placeholder="Descreva detalhadamente como ocorreu o fato, circunst√¢ncias, testemunhas, etc."></textarea>
                </div>
            </div>

        <div class="text-center">
            <button type="submit" class="btn btn-success">Salvar Ocorr√™ncia</button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
    </div>
</div>

<style>
.file-upload-label {
    display: block;
    padding: 15px;
    border: 2px dashed #007bff;
    border-radius: 8px;
    background-color: #f8f9fa;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 10px;
}

.file-upload-label:hover {
    background-color: #e7f3ff;
    border-color: #0056b3;
}

.file-upload-label span {
    color: #007bff;
    font-weight: 500;
    font-size: 14px;
}

.file-input-field {
    display: none;
}

.file-upload-label.has-file {
    background-color: #d4edda;
    border-color: #28a745;
}

.file-upload-label.has-file span {
    color: #155724;
}
</style>

<script>
let customImageIndex = 0;

document.addEventListener('DOMContentLoaded', function() {
    const tipoOcorrencia = document.getElementById('tipo');
    const tipoTerreno = document.getElementById('tipo_terreno_agua');
    
    tipoOcorrencia.addEventListener('change', function() {
        if (this.value === 'Busca Terrestre') {
            tipoTerreno.value = 'Terrestre';
            tipoTerreno.disabled = true;
        } else if (this.value === 'Busca Mar√≠tima') {
            tipoTerreno.value = '';
            tipoTerreno.disabled = false;
        } else {
            tipoTerreno.value = '';
            tipoTerreno.disabled = false;
        }
    });

    // Atualizar labels de upload quando arquivo for selecionado
    const fileInputs = document.querySelectorAll('.file-input-field');
    fileInputs.forEach(input => {
        input.addEventListener('change', function(e) {
            const label = document.querySelector(`label[for="${this.id}"]`);
            const labelSpan = document.getElementById(`label_${this.id}`);
            
            if (e.target.files.length > 0) {
                const fileName = e.target.files[0].name;
                labelSpan.textContent = `‚úÖ ${fileName}`;
                label.classList.add('has-file');
            } else {
                labelSpan.textContent = 'üì∑ Clique para selecionar a imagem';
                label.classList.remove('has-file');
            }
        });
    });

    // Sistema de imagens customizadas
    const container = document.getElementById('custom-images-container');
    const addBtn = document.getElementById('add-custom-image-btn');

    function addCustomImageField() {
        const index = customImageIndex++;
        const div = document.createElement('div');
        div.className = 'custom-image-item mb-3 p-3 border rounded';
        div.setAttribute('data-index', index);
        
        div.innerHTML = `
            <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-0">Imagem Customizada #${index + 1}</h6>
                <button type="button" class="btn btn-sm btn-danger remove-custom-image" data-index="${index}">
                    üóëÔ∏è Remover
                </button>
            </div>
            <div class="form-group mb-2">
                <label for="custom_titulo_${index}">T√≠tulo/Descri√ß√£o da Imagem <span class="required">*</span></label>
                <input type="text" name="custom_titulo_${index}" id="custom_titulo_${index}" 
                       class="form-control" required placeholder="Ex: Mapa de correntes, Foto a√©rea, etc.">
            </div>
            <div class="form-group mb-2">
                <div class="d-flex align-items-center gap-2 mb-2">
                    <input type="checkbox" name="custom_usa_${index}" id="custom_usa_${index}" checked>
                    <label for="custom_usa_${index}" style="margin: 0;">Usar esta imagem no relat√≥rio</label>
                </div>
                <input type="file" name="custom_imagem_${index}" id="custom_imagem_${index}" 
                       class="form-control" accept="image/*" required>
            </div>
        `;
        
        container.appendChild(div);
        
        // Adiciona evento de remo√ß√£o
        div.querySelector('.remove-custom-image').addEventListener('click', function() {
            div.remove();
        });
    }

    addBtn.addEventListener('click', addCustomImageField);
});
</script>
{% endblock %}